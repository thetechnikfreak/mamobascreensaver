<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mamoba Screensaver</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: #000;
      overflow: hidden;
      font-family: Arial, sans-serif;
      cursor: none;
    }
    
    #logo {
      position: fixed;
      user-select: none;
      pointer-events: none;
      transition: none;
      image-rendering: auto;
      max-width: 200px;
      max-height: 150px;
      object-fit: contain;
    }
    
    .loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 18px;
    }
    
    @media (max-width: 768px) {
      #logo {
        max-width: 150px;
        max-height: 100px;
      }
    }
  </style>
</head>
<body>
  <div class="loading" id="loading">Lade Screensaver...</div>
  <img id="logo" src="/mamobascreensaver/logos/1.png" alt="Mamoba Logo" style="display: none;">

  <script>
    class MamobaScreensaver {
      constructor() {
        this.logo = document.getElementById("logo");
        this.loading = document.getElementById("loading");
        this.totalLogos = 5;
        this.currentLogo = 1;
        this.animationId = null;
        this.isRunning = false;
        
        // Animation properties
        this.position = { x: 0, y: 0 };
        this.direction = { x: 1, y: 1 };
        this.speed = 2;
        this.dimensions = { width: 0, height: 0 };
        this.viewport = { width: 0, height: 0 };
        
        this.init();
      }
      
      init() {
        this.setupEventListeners();
        this.preloadImages();
      }
      
      setupEventListeners() {
        // Responsive viewport updates
        const updateViewport = () => {
          this.viewport.width = window.innerWidth;
          this.viewport.height = window.innerHeight;
          this.constrainPosition();
        };
        
        window.addEventListener("resize", updateViewport);
        window.addEventListener("orientationchange", updateViewport);
        
        // Pause on visibility change
        document.addEventListener("visibilitychange", () => {
          if (document.hidden) {
            this.pause();
          } else {
            this.resume();
          }
        });
        
        // Stop on user interaction
        const stopOnInteraction = () => {
          if (this.isRunning) {
            this.pause();
            setTimeout(() => this.resume(), 3000); // Resume after 3 seconds
          }
        };
        
        document.addEventListener("mousemove", stopOnInteraction);
        document.addEventListener("keydown", stopOnInteraction);
        document.addEventListener("touchstart", stopOnInteraction);
      }
      
      async preloadImages() {
        const promises = [];
        for (let i = 1; i <= this.totalLogos; i++) {
          const img = new Image();
          img.src = `/mamobascreensaver/logos/${i}.png`;
          promises.push(new Promise((resolve, reject) => {
            img.onload = resolve;
            img.onerror = () => {
              console.warn(`Logo ${i} konnte nicht geladen werden`);
              resolve(); // Continue even if some images fail
            };
          }));
        }
        
        try {
          await Promise.all(promises);
          this.startAnimation();
        } catch (error) {
          console.error("Fehler beim Laden der Bilder:", error);
          this.startAnimation(); // Start anyway
        }
      }
      
      startAnimation() {
        this.loading.style.display = "none";
        this.logo.style.display = "block";
        
        // Wait for logo to load
        if (this.logo.complete) {
          this.initializePosition();
          this.animate();
        } else {
          this.logo.onload = () => {
            this.initializePosition();
            this.animate();
          };
          
          // Fallback if image fails to load
          this.logo.onerror = () => {
            console.error("Logo konnte nicht geladen werden");
            this.loading.textContent = "Fehler beim Laden des Logos";
            this.loading.style.display = "block";
          };
        }
      }
      
      initializePosition() {
        this.updateDimensions();
        this.updateViewport();
        
        // Random starting position with bounds checking
        this.position.x = Math.max(0, Math.min(
          Math.random() * (this.viewport.width - this.dimensions.width),
          this.viewport.width - this.dimensions.width
        ));
        
        this.position.y = Math.max(0, Math.min(
          Math.random() * (this.viewport.height - this.dimensions.height),
          this.viewport.height - this.dimensions.height
        ));
        
        // Random direction
        this.direction.x = Math.random() < 0.5 ? -1 : 1;
        this.direction.y = Math.random() < 0.5 ? -1 : 1;
        
        this.updatePosition();
        this.isRunning = true;
      }
      
      updateDimensions() {
        this.dimensions.width = this.logo.offsetWidth || this.logo.naturalWidth || 100;
        this.dimensions.height = this.logo.offsetHeight || this.logo.naturalHeight || 75;
      }
      
      updateViewport() {
        this.viewport.width = window.innerWidth;
        this.viewport.height = window.innerHeight;
      }
      
      constrainPosition() {
        if (this.viewport.width <= this.dimensions.width) {
          this.position.x = 0;
        } else {
          this.position.x = Math.max(0, Math.min(this.position.x, this.viewport.width - this.dimensions.width));
        }
        
        if (this.viewport.height <= this.dimensions.height) {
          this.position.y = 0;
        } else {
          this.position.y = Math.max(0, Math.min(this.position.y, this.viewport.height - this.dimensions.height));
        }
      }
      
      changeLogo() {
        this.currentLogo = (this.currentLogo % this.totalLogos) + 1;
        this.logo.src = `/mamobascreensaver/logos/${this.currentLogo}.png`;
      }
      
      animate() {
        if (!this.isRunning) return;
        
        // Update position
        this.position.x += this.speed * this.direction.x;
        this.position.y += this.speed * this.direction.y;
        
        let bounced = false;
        
        // Boundary collision detection
        if (this.position.x <= 0) {
          this.position.x = 0;
          this.direction.x = 1;
          bounced = true;
        } else if (this.position.x >= this.viewport.width - this.dimensions.width) {
          this.position.x = this.viewport.width - this.dimensions.width;
          this.direction.x = -1;
          bounced = true;
        }
        
        if (this.position.y <= 0) {
          this.position.y = 0;
          this.direction.y = 1;
          bounced = true;
        } else if (this.position.y >= this.viewport.height - this.dimensions.height) {
          this.position.y = this.viewport.height - this.dimensions.height;
          this.direction.y = -1;
          bounced = true;
        }
        
        if (bounced) {
          this.changeLogo();
        }
        
        this.updatePosition();
        this.animationId = requestAnimationFrame(() => this.animate());
      }
      
      updatePosition() {
        this.logo.style.transform = `translate(${Math.round(this.position.x)}px, ${Math.round(this.position.y)}px)`;
      }
      
      pause() {
        this.isRunning = false;
        if (this.animationId) {
          cancelAnimationFrame(this.animationId);
          this.animationId = null;
        }
      }
      
      resume() {
        if (!this.isRunning && this.logo.style.display !== "none") {
          this.isRunning = true;
          this.updateViewport();
          this.updateDimensions();
          this.constrainPosition();
          this.animate();
        }
      }
    }
    
    // Initialize screensaver when page loads
    document.addEventListener("DOMContentLoaded", () => {
      new MamobaScreensaver();
    });
  </script>
</body>
</html>
